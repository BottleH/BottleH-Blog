---
title: 7ìž¥ íŠ¸ëžœìž­ì…˜
thumbnail: ../images/db/Designing_Data_Intensive_Applications.png
date: 2023-04-16 18:10:51
category: Back-End
tags: [DB]
draft: false
---

> ì–´ë–¤ ì €ìžë“¤ì€ 2ë‹¨ê³„ ì»¤ë°‹ì—ì„œ ìœ ë°œë˜ëŠ” ì„±ëŠ¥ì´ë‚˜ ê°€ìš©ì„± ë¬¸ì œ ë•Œë¬¸ì— ìƒê¸°ëŠ” ë¹„ìš©ì´ ë„ˆë¬´ ì»¤ì„œ ì´ë¥¼ ì§€ì›í•  ìˆ˜ ì—†ë‹¤ê³  ì£¼ìž¥í–ˆë‹¤. ìš°ë¦¬ëŠ” í•­ìƒ íŠ¸ëžœìž­ì…˜ ì—†ì´ ì½”ë”©í•˜ëŠ” ê²ƒë³´ë‹¤ íŠ¸ëžœìž­ì…˜ì„ ê³¼ìš©í•´ì„œ ë³‘ëª©ì§€ì ì´ ìƒê¸°ëŠ” ì„±ëŠ¥ ë¬¸ì œë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ í”„ë¡œê·¸ëž˜ë¨¸ê°€ ì²˜ë¦¬í•˜ê²Œ í•˜ëŠ” ê²Œ ë‚«ë‹¤ê³  ìƒê°í•œë‹¤. - ì œìž„ìŠ¤ ì½”ë²³ ì™¸, ìŠ¤íŒ¨ë„ˆ: êµ¬ê¸€ì˜ ì „ì—­ ë¶„ì‚° ë°ì´í„°ë² ì´ìŠ¤(2012)

íŠ¸ëžœìž­ì…˜ì´ëž€â“

- Applicationì—ì„œ ëª‡ ê°œì˜ ì½ê¸°ì™€ ì“°ê¸°ë¥¼ í•˜ë‚˜ì˜ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ë¬¶ëŠ” ë°©ë²•
- ê°œë…ì ìœ¼ë¡œ í•œ íŠ¸ëžœìž­ì…˜ ë‚´ì˜ ëª¨ë“  ì½ê¸°ì™€ ì“°ê¸°ëŠ” í•œ ì—°ì‚°ìœ¼ë¡œ ì‹¤í–‰
- íŠ¸ëžœìž­ì…˜ì€ ì „ì²´ê°€ ì„±ê³µ(commit), ì‹¤íŒ¨(abort)í•œë‹¤.
  - applicationì—ì„œ retryê°€ ê°€ëŠ¥í•˜ë©°, ë¶€ë¶„ì ì¸ ì‹¤íŒ¨ë¥¼ ê±±ì •í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì—, error handlingì´ ì†ì‰¬ì›Œì§„ë‹¤.
- Applicationì—ì„œ í”„ë¡œê·¸ëž˜ë° ëª¨ë¸ì„ ë‹¨ìˆœí™”**í•˜ë ¤ëŠ” ëª©ì ìœ¼ë¡œ ë§Œë“  ê²ƒ
- Applicationì—ì„œ ìž ìž¬ì ì¸ ì˜¤ë¥˜ ì‹œë‚˜ë¦¬ì˜¤ì™€ ë™ì‹œì„± ë¬¸ì œë¥¼ ë¬´ì‹œí•  ìˆ˜ ìžˆë‹¤.
  - **ì•ˆì „ì„± ë³´ìž¥(safety guarantee)
- ì„±ëŠ¥í–¥ìƒ í˜¹ì€ ê°€ìš©ì„±ì„ ë†’ì´ê¸° ìœ„í•´ íŠ¸ëžœìž­ì…˜ì„ ì“°ì§€ ì•ŠëŠ” ê²ƒì´ ì´ë“ì¼ ìˆ˜ ìžˆë‹¤.
  - ì´ì— ëŒ€í•œ íŒë‹¨ì„ í•˜ê¸° ìœ„í•´ íŠ¸ëžœìž­ì…˜ì´ ì œê³µí•˜ëŠ” ì•ˆì „ì„± ë³´ìž¥ê³¼ ë¹„ìš©ì´ ë¬´ì—‡ì¸ì§€ ì •í™•ì´ ì´í•´í•´ì•¼ í•œë‹¤.

## ðŸ“– 7.1 ì• ë§¤ëª¨í˜¸í•œ íŠ¸ëžœìž­ì…˜ì˜ ê°œë…

___

íŠ¸ëžœìž­ì…˜ì€ ì´ì ê³¼ í•œê³„ê°€ ìžˆë‹¤. ì´ trade-offë¥¼ ì´í•´í•˜ê¸° ìœ„í•´ ì •ìƒì ì¸ ìš´ì˜ ìƒí™©ê³¼ ë‹¤ì–‘í•œ ê·¹ë‹¨ì ì¸ í™˜ê²½ì—ì„œ íŠ¸ëžœìž­ì…˜ì´ ì œê³µí•˜ëŠ” ë³´ìž¥ì˜ ì„¸ë¶€ ì‚¬í•­ì„ ì•Œì•„ì•¼ í•œë‹¤.

### ðŸ”– 7.1.1 ACIDì˜ ì˜ë¯¸

íŠ¸ëžœìž­ì…˜ì´ ì œê³µí•˜ëŠ” ì•ˆì „ì„± ë³´ìž¥ì€ í”ížˆ ì›ìžì„±(Atomicity), ì¼ê´€ì„±(Consistency), ê²©ë¦¬ì„±(Isolation), ì§€ì†ì„±(Durability)ì„ ì˜ë¯¸í•˜ëŠ” ì•½ì–´ì¸ ACIDë¡œ ìž˜ ì•Œë ¤ì ¸ ìžˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë‚´ê²°í•¨ì„± ë©”ì»¤ë‹ˆì¦˜ì„ ë‚˜íƒ€ë‚´ëŠ” ì •í™•í•œ ìš©ì–´ë¥¼ í™•ë¦½í•˜ê¸° ìœ„í•´ ë§Œë“¤ì–´ì§.

- ë‚´ê²°í•¨ì„±: ì‹œìŠ¤í…œì˜ ì¼ë¶€ êµ¬ì„± ìš”ì†Œê°€ ìž‘ë™í•˜ì§€ ì•Šë”ë¼ë„ ê³„ì† ìž‘ë™í•  ìˆ˜ ìžˆë„ë¡ í•˜ëŠ” ê¸°ëŠ¥

#### ðŸ›  7.1.1.1 ì›ìžì„±

ì¼ë°˜ì ìœ¼ë¡œ ì›ìžì **ì´ëž€ ë” ìž‘ì€ ë¶€ë¶„ìœ¼ë¡œ ìª¼ê°¤ ìˆ˜ ì—†ëŠ” ê²ƒì„ ê°€ë¦¬í‚¨ë‹¤. ë‹¤ë§Œ ì—¬ê¸°ì„œ ì“°ì´ëŠ” ì›ìžì„±ì€ ì—°ì‚°ì„ ì‹¤í–‰í•˜ê¸° ì „ì´ë‚˜ ì‹¤í–‰í•œ í›„ì˜ ìƒíƒœì—ë§Œ ìžˆì„ ìˆ˜ ìžˆìœ¼ë©° ê·¸ ì¤‘ê°„ ìƒíƒœì—ëŠ” ë¨¸ë¬¼ ìˆ˜ ì—†ë‹¤.

- ì˜ˆë¥¼ ë“¤ì–´, ì—¬ëŸ¬ ì“°ê¸° ìž‘ì—…ì´ í•˜ë‚˜ì˜ íŠ¸ëžœìž­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ ìžˆëŠ”ë° ê²°í•¨ ë•Œë¬¸ì— commitë  ìˆ˜ ì—†ë‹¤ë©´ abortë˜ê³  ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì´ íŠ¸ëžœìž­ì…˜ì—ì„œ ì§€ê¸ˆê¹Œì§€ ì‹¤í–‰í•œ ì“°ê¸°ë¥¼ ë¬´ì‹œí•˜ê±°ë‚˜ ì¥ì†Œí•´ì•¼ í•œë‹¤.
- Applicationì—ì„œ íŠ¸ëžœìž­ì…˜ì´ ì–´ë–¤ ê²ƒë„ ë³€ê²½í•˜ì§€ ì•Šì•˜ìŒì„ ì•Œ ìˆ˜ ìžˆìœ¼ë¯€ë¡œ **ì•ˆì „í•˜ê²Œ ìž¬ì‹œë„**í•  ìˆ˜ ìžˆë‹¤.
- ì–´ë³´íŠ¸ëŠ¥ë ¥(abortability)ì´ ì›ìžì„±(Atomicity)ë³´ë‹¤ ë‚˜ì€ ë‹¨ì–´ì¼ ìˆ˜ ìžˆë‹¤.

#### ðŸ›  7.1.1.2 ì¼ê´€ì„±

ì¼ê´€ì„±ì´ëž€ ë‹¨ì–´ëŠ” êµ‰ìž¥ížˆ ì—¬ëŸ¬ ì˜ë¯¸ë¡œ ì“°ì¸ë‹¤.

- [5ìž¥ì˜ ë³µì œì¼ê´€ì„±ê³¼ ìµœì¢…ì ì¼ê´€ì„±](https://github.com/Study-Br/Study-Designing-Data-Intensive-Applications/issues/5)
- [6ìž¥ì˜ ì¼ê´€ì  í•´ì‹±](https://github.com/Study-Br/Study-Designing-Data-Intensive-Applications/issues/6)
- 9ìž¥ì˜ ì„ í˜•ì„±
- ACIDì—ì„œ ì¼ê´€ì„±ì€ ë°ì´í„°ë² ì´ìŠ¤ê°€ **ì¢‹ì€ìƒíƒœ ì— ìžˆì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì˜ Applicationì— íŠ¹í™”ëœ ê°œë…
  - ë°ì´í„°ì— ê´€í•œ **ë¶ˆë³€ì‹**ì´ ìžˆë‹¤ëŠ” ê²ƒ
  - ex) íšŒê³„ì˜ ëª¨ë“  ê³„ì¢Œì— ê±¸ì¹œ ëŒ€ë³€ê³¼ ì°¨ë³€ì€ ë™ì¼í•˜ë‹¤.

ì¼ê´€ì„±ì„ ìœ ì§€í•˜ë„ë¡ íŠ¸ëžœìž­ì…˜ì„ ì˜¬ë°”ë¥´ê²Œ ì •ì˜í•˜ëŠ” ê²ƒì€ Applicationì˜ ì±…ìž„ì´ë‹¤â—ï¸

- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ë¶ˆë³€ì‹ì„ ìœ„ë°˜í•˜ëŠ” ìž˜ëª»ëœ ë°ì´í„°ë¥¼ ì“°ì§€ ëª»í•˜ë„ë¡ ë§‰ì„ ìˆ˜ ì—†ë‹¤.
- ì‹¤ì œë¡œ ACIDì˜ CëŠ” ì•½ì–´ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ ë¼ì–´ë“¤ì—ˆë‹¤ê³  í‘œí˜„ë˜ë©°, Application ì†ì„±ìœ¼ë¡œ ì·¨ê¸‰í•œë‹¤.

#### ðŸ›  7.1.1.3 ê²©ë¦¬ì„±

![7-1](./img/7-1.png)

ìœ„ ê·¸ë¦¼ì„ ë³´ë©´ ë‘ Clientì˜ ê²½í•©ìœ¼ë¡œ ì¸í•´, countê°€ 44ê°€ ì•„ë‹Œ 43ì´ ëœ ê²ƒì„ ë³¼ ìˆ˜ ìžˆë‹¤.

ê²©ë¦¬ì„±ì€ ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëžœìž­ì…˜ì€ ì„œë¡œ ê²©ë¦¬ëœë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.
ì¦‰, ì‹¤ì œë¡œëŠ” ì—¬ëŸ¬ íŠ¸ëžœìž­ì…˜ì´ ë™ì‹œì— ì‹¤í–‰ëë”ë¼ë„ ìˆœì°¨ì ìœ¼ë¡œ ì‹¤í–‰ëì„ ë•Œì˜ ê²°ê³¼ì™€ ë™ì¼í•˜ë„ë¡ ë³´ìž¥í•œë‹¤.

- ê²©ë¦¬ì„±ì„ ì§ë ¬ì„±ì´ë¼ëŠ” ìš©ì–´ë¡œ ì‚¬ìš©í•˜ê¸°ë„ í–ˆë‹¤.
- ì§ë ¬ì„± ê²©ë¦¬ëŠ” ì„±ëŠ¥ ì´ìŠˆê°€ ìžˆì–´ í˜„ì‹¤ì—ì„œëŠ” ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - Oracleì˜ ì§ë ¬ì„± ê²©ë¦¬ëŠ” ì‹¤ì œë¡œëŠ” ì§ë ¬ì„±ë³´ë‹¤ ë³´ìž¥ì´ ì•½í•œ **ìŠ¤ëƒ…ìˆ ê²©ë¦¬**ë¥¼ êµ¬í˜„í•œ ê²ƒ

#### ðŸ›  7.1.1.4 ì§€ì†ì„±

ì§€ì†ì„±ì€ íŠ¸ëžœìž­ì…˜ì´ ì„±ê³µì ìœ¼ë¡œ commitëë‹¤ë©´ í•˜ë“œì›¨ì–´ ê²°í•¨ì´ ë°œìƒí•˜ê±°ë‚˜ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì£½ë”ë¼ë„ íŠ¸ëžœìž­ì…˜ì—ì„œ ê¸°ë¡í•œ ëª¨ë“  ë°ì´í„°ëŠ” ì†ì‹¤ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ë³´ìž¥ì´ë‹¤.

- ë‹¨ì¼ ë…¸ë“œ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§€ì†ì„±ì€ ì¼ë°˜ì ìœ¼ë¡œ ë°ì´í„°ê°€ ë¹„íœ˜ë°œì„± ì €ìž¥ì†Œì— ê¸°ë¡ëë‹¤ëŠ” ëœ»
- ë³µì œ ê¸°ëŠ¥ì´ ìžˆëŠ” ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì§€ì†ì„±ì€ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë‹¤ë¥¸ ë…¸ë“œì— ë³µì‚¬ ëë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•  ìˆ˜ ìžˆìŒ.
- ì™„ë²½í•˜ê³  ì ˆëŒ€ì ì¸ ì§€ì†ì„±ì€ ì—†ë‹¤.
  - SSD ì˜¤ì—¼, ì „ì› ì°¨ë‹¨, ë¦¬ë”ê°€ ì£½ì€ ê²½ìš° ë“±

##### ì‹œëŒ€ì— ë”°ë¥¸ ì§€ì†ì„±ì˜ ì˜ë¯¸

ì•„ì¹´ì´ë¸Œ í…Œì´í”„ì— ê¸°ë¡ â–¶ï¸ ë””ìŠ¤í¬ë‚˜ SSDì— ê¸°ë¡ â–¶ï¸ ë³µì œ

### ðŸ”– 7.1.2 ë‹¨ì¼ ê°ì²´ ì—°ì‚°ê³¼ ë‹¤ì¤‘ ê°ì²´ ì—°ì‚°

ACIDì—ì„œ ì›ìžì„±ê³¼ ê²©ë¦¬ì„±ì€ Clientê°€ í•œ íŠ¸ëžœìž­ì…˜ ë‚´ì—ì„œ ì—¬ëŸ¬ ë²ˆì˜ ì“°ê¸°ë¥¼ í•˜ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ ì–´ë–»ê²Œ í•´ì•¼ í•˜ëŠ”ì§€ë¥¼ ì„¤ëª…í•¨.

- ì›ìžì„±: ë¶€ë¶„ ì‹¤íŒ¨ë¥¼ ì—†ì• ì¤Œ.
- ê²©ë¦¬ì„±: ë™ì‹œì— ì‹¤í–‰ë˜ëŠ” íŠ¸ëžœìž­ì…˜ë“¤ì€ ì„œë¡œë¥¼ ë°©í•´í•˜ì§€ ë§ì•„ì•¼ í•œë‹¤.

RDBì˜ ë‹¤ì¤‘ ê°ì²´ íŠ¸ëžœìž­ì…˜

- Clientì™€ DB Server ì‚¬ì´ì˜ TCP ì—°ê²°ì„ ê¸°ë°˜ìœ¼ë¡œ í•¨.
- beginê³¼ commit ì‚¬ì´ì˜ ëª¨ë“  ê²ƒì€ ê°™ì€ íŠ¸ëžœìž­ì…˜ì— ì†í•˜ëŠ” ê²ƒìœ¼ë¡œ ì—¬ê²¨ì§.
- ì´ ë°©ì‹ì€ Clientê°€ commit ìš”ì²­ì„ ë³´ë‚´ê³  Serverê°€ commit ì‘ë‹µì„ í•˜ê¸° ì „ì— ì—°ê²°ì´ ëŠê¸´ë‹¤ë©´ ClientëŠ” íŠ¸ëžœìž­ì…˜ì´ commitëëŠ”ì§€ ì•Œ ìˆ˜ ì—†ë‹¤.

NoSQLì˜ ë‹¤ì¤‘ ê°ì²´ íŠ¸ëžœìž­ì…˜

- NoSQLì€ RDBì™€ ë‹¤ë¥´ê²Œ ë‹¤ì¤‘ ê°ì²´ APIê°€ ìžˆë”ë¼ë„ ë¶€ë¶„ ì„±ê³µì´ ë  ìˆ˜ ìžˆë‹¤.

#### ðŸ›  7.1.2.1 ë‹¨ì¼ ê°ì²´ ì“°ê¸°

ì›ìžì„±ê³¼ ê²©ë¦¬ì„±ì€ ë‹¨ì¼ ê°ì²´ë¥¼ ë³€ê²½í•˜ëŠ” ê²½ìš°ì—ë„ ì ìš©ëœë‹¤.

> 20KB ì¤‘ 10KBë¥¼ ë³´ë‚¸ í›„ì— ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ëŠê¸°ë©´?
> DB Table Update ì¤‘ì— ì „ì›ì´ ë‚˜ê°€ë©´?
> ë¬¸ì„œë¥¼ ì“°ê³  ìžˆì„ ë•Œ, ê·¸ ë¬¸ì„œë¥¼ ì½ìœ¼ë©´?

ìœ„ì™€ ê°™ì€ ë¬¸ì œë¡œ ì¸í•´, ëŒ€ë¶€ë¶„ì˜ ì €ìž¥ì†Œ ì—”ì§„ë“¤ì€ í•œ ë…¸ë“œì— ì¡´ìž¬í•˜ëŠ” ë‹¨ì¼ ê°ì²´ ìˆ˜ì¤€ì—ì„œ ìš°ë„ˆìžì„±ê³¼ ê²©ë¦¬ì„±ì„ ì œê³µí•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•¨.

- ì›ìžì„±ì€ ìž¥ì•  ë³µêµ¬ìš© ë¡œê·¸ë¡œ êµ¬í˜„
- ê²©ë¦¬ì„±ì€ ê°ì²´ ìž ê¸ˆì„ ì‚¬ìš©

#### ðŸ›  7.1.2.2 ì˜¤ë¥˜ì™€ ì–´ë³´íŠ¸ ì²˜ë¦¬

abortëœ íŠ¸ëžœìž­ì…˜ì„ ìž¬ì‹œë„í•˜ëŠ” ê²ƒì€ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ì¸ ì˜¤ë¥˜ ì²˜ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì´ì§€ë§Œ ì™„ë²½í•˜ì§€ëŠ” ì•Šë‹¤.

- serverê°€ clientì—ê²Œ commit ì„±ê³µì„ ì•Œë¦¬ëŠ” ë„ì¤‘ ë„¤íŠ¸ì›Œí¬ê°€ ëŠê²¼ì„ ë•Œ -> ìž¬ì‹œë„í•˜ë©´ íŠ¸ëžœìž­ì…˜ ë‘ ë²ˆ ì‹¤í–‰
- ê³¼ë¶€í•˜ë¡œ ì¸í•œ íŠ¸ëžœìž­ì…˜ ì‹¤íŒ¨ -> ìž¬ì‹œë„í•˜ë©´ ìƒí™© ì•…í™”
- ì˜êµ¬ì ì¸ ì˜¤ë¥˜ëŠ” ìž¬ì‹œë„í•´ë„ ì˜ë¯¸ ì—†ìŒ.
- íŠ¸ëžœìž­ì…˜ì´ ì™¸ë¶€ì—ë„ ì˜í–¥ì´ ìžˆë‹¤ë©´(email ë°œì†¡) ìž¬ì‹œë„ë¥¼ í•˜ê¸° ë¶€ë‹´ìŠ¤ëŸ½ë‹¤.
- clientê°€ ìž¬ì‹œë„ ì¤‘ì— ì£½ì–´ë²„ë¦¬ë©´ ì“°ë ¤ë˜ ë°ì´í„°ê°€ ì†ì‹¤ë¨.

## ðŸ“– 7.2 ì™„í™”ëœ ê²©ë¦¬ ìˆ˜ì¤€

___

ë™ì‹œì„± ë²„ê·¸ëŠ” ë°œê²¬í•˜ê¸°ë„, ì¶”ë¡ í•˜ê¸°ë„, ìž¬í˜„í•˜ê¸°ë„ ì–´ë µë‹¤.
ì´ì— ë”°ë¼, ë°ì´í„°ë² ì´ìŠ¤ëŠ” íŠ¸ëžœìž­ì…˜ ê²©ë¦¬ë¥¼ ì œê³µí•¨ìœ¼ë¡œì¨ ë™ì‹œì„± ë¬¸ì œë¥¼ ê°ì¶”ê³ ìž í•œë‹¤.

### ðŸ”– 7.2.1 ì»¤ë°‹ í›„ ì½ê¸°(read committed)

1. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì½ì„ ë•Œ ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ë³´ê²Œ ëœë‹¤.(ë”í‹° ì½ê¸° ë°©ì§€)
2. ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì“¸ ë•Œ ì»¤ë°‹ëœ ë°ì´í„°ë§Œ ë®ì–´ì“°ê²Œ ëœë‹¤.(ë”í‹° ì“°ê¸° ë°©ì§€)

#### ðŸ›  7.2.1.1 ë”í‹° ì½ê¸° ë°©ì§€

ë”í‹° ì½ê¸°ëž€ ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì—ì„œ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìžˆëŠ” ê²ƒ

- ë”í‹° ì½ê¸°ë¥¼ ë°©ì§€í•˜ì§€ ì•Šìœ¼ë©´ ë¶€ë¶„ì ìœ¼ë¡œ ê°±ì‹ ëœ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë³¼ ìˆ˜ ìžˆëŠ” ë“± í˜¼ëž€ìŠ¤ëŸ¬ì›Œì§„ë‹¤.

#### ðŸ›  7.2.1.2 ë”í‹° ì“°ê¸° ë°©ì§€

![7-5](./img/7-5.png)

ë”í‹° ì“°ê¸°ëž€ ì»¤ë°‹ë˜ì§€ ì•Šì€ íŠ¸ëžœìž­ì…˜ì—ì„œ ì“´ ê²ƒì„ ë‚˜ì¤‘ì— ì‹¤í–‰ëœ ì“°ê¸° ìž‘ì—…ì´ ë®ì–´ì¨ë²„ë¦¬ëŠ” ê²ƒ

- ë¨¼ì € ì“´ íŠ¸ëžœìž­ì…˜ì´ ì»¤ë°‹ì´ë‚˜ ì–´ë³´íŠ¸ë  ë•Œê¹Œì§€ ë‘ ë²ˆì§¸ ì“°ê¸°ë¥¼ ì§€ì—°ì‹œì¼œ í•´ê²°í•œë‹¤.

#### ðŸ›  7.2.1.3 ì»¤ë°‹ í›„ ì½ê¸° êµ¬í˜„

row level lockì„ ì‚¬ìš©í•´ ë”í‹° ì“°ê¸°ë¥¼ ë°©ì§€í•¨.

- ë¬¸ì„œ ë³€ê²½ì„ ìœ„í•´ í•´ë‹¹ ê°ì²´ì— ëŒ€í•œ ìž ê¸ˆ íšë“ì´ í•„ìš”
- MySQL: X Lock, PostgreSQL: RowExclusiveLock, Oracle: TX Lock

ì½ê¸° ìž ê¸ˆ ë˜í•œ ìžˆì§€ë§Œ í˜„ì‹¤ì—ì„œëŠ” ìž˜ ë™ìž‘í•˜ì§€ë„, ì“°ì§€ë„ ì•ŠëŠ”ë‹¤.

- ì„±ëŠ¥, ì„œë¹„ìŠ¤ ì „ì²´ ì˜í–¥ë„ ë“±

### ðŸ”– 7.2.2 ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì™€ ë°˜ë³µ ì½ê¸°

![7-6](./img/7-6.png)

- ë¹„ë°˜ë³µì½ê¸°(ì½ê¸° ìŠ¤í)
  - íŠ¸ëžœìž­ì…˜ì´ ì²˜ë¦¬ë˜ê³  ìžˆëŠ” ìˆœê°„ì— ê³„ì¢Œ ìž”ê³ ë¥¼ ë³´ê²Œ ë˜ë©´ ëˆì´ ì¦ë°œí•œ ê²ƒ ì²˜ëŸ¼ ë³´ìž„
  - ì¼ê´€ì„±ì´ ê¹¨ì§„ ìƒíƒœì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë´„
  - ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì§€ì†ì ì¸ ë¬¸ì œëŠ” ì•„ë‹˜(ìƒˆë¡œê³ ì¹¨ ë“±)
  - ë‹¤ë§Œ ë°±ì—…ì„ í•˜ê³ ìžˆëŠ” ìƒí™©ì´ë‚˜, ì¤‘ìš”í•œ ë¶„ì„ ì§ˆì˜, ë¬´ê²°ì„± ëª¨ë‹ˆí„°ë§ì— ì¢‹ì§€ ì•Šì€ ì˜í–¥ì„ ë¼ì¹¨
- ìŠ¤ëƒ…ìˆ ê²©ë¦¬
  - ê° íŠ¸ëžœìž­ì…˜ì€ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¼ê´€ëœ ìŠ¤ëƒ…ìˆìœ¼ë¡œë¶€í„° ì½ëŠ” ê²ƒ
  - íŠ¸ëžœìž­ì…˜ì´ íŠ¹ì • ì‹œì ì— ê³ ì •ëœ ë°ì´í„°ë² ì´ìŠ¤ì˜ ì¼ê´€ëœ ìŠ¤ëƒ…ìˆë§Œ ë³¸ë‹¤ë©´ ë¶„ì„ì— ì¶”ë¡ í•˜ê¸° ìš©ì´

#### ðŸ›  7.2.2.1 ìŠ¤ëƒ…ìˆ ê²©ë¦¬ êµ¬í˜„

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì˜ í•µì‹¬ ì›ë¦¬

- ì½ëŠ” ìª½ì—ì„œ ì“°ëŠ” ìª½ì„ ê²°ì½” ì°¨ë‹¨í•˜ì§€ ì•Šê³  ì“°ëŠ” ìª½ì—ì„œ ì½ëŠ” ìª½ì„ ê²°ì½” ì°¨ë‹¨í•˜ì§€ ì•ŠëŠ”ë‹¤
- ë‹¤ì¤‘ ë²„ì „ ë™ì‹œì„± ì œì–´(MVCC)
  - ê°ì²´ë§ˆë‹¤ ì»¤ë°‹ëœ ë²„ì „ ì—¬ëŸ¬ ê°œë¥¼ ìœ ì§€í•  ìˆ˜ ìžˆì–´ì•¼ í•¨
  - ì§„í–‰ ì¤‘ì¸ ì„œë¡œ ë‹¤ë¥¸ ì‹œì ì˜ ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœë¥¼ ë´ì•¼í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸
  - ì»¤ë°‹ í›„ ì½ê¸° ê²©ë¦¬ì˜ ê²½ìš°ëŠ” ë²„ì „ 2ê°œ(ì»¤ë°‹ëœ ë²„ì „, ì»¤ë°‹ë˜ì§€ ì•Šì€ ë²„ì „)ë§Œìœ¼ë¡œ ì¶©ë¶„í•˜ì§€ë§Œ ëŒ€ë¶€ë¶„ì˜ ìŠ¤ëƒ…ìˆ ê²©ë¦¬ë¥¼ ì§€ì›í•˜ëŠ” ì €ìž¥ì†Œ ì—”ì§„ì€ MVCCë¥¼ ì‚¬ìš©í•œë‹¤.

#### ðŸ›  7.2.2.2 ì¼ê´€ëœ ìŠ¤ëƒ…ìˆì„ ë³´ëŠ” ê°€ì‹œì„± ê·œì¹™

```text
1. ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê° íŠ¸ëžœìž­ì…˜ì„ ì‹œìž‘í•  ë•Œ ê·¸ ì‹œì ì— ì§„í–‰ ì¤‘ì¸(ì•„ì§ ì»¤ë°‹ì´ë‚˜ ì–´ë³´íŠ¸ê°€ ë˜ì§€ ì•Šì€) ëª¨ë“  íŠ¸ëžœìž­ì…˜ì˜ ëª©ë¡ì„ ë§Œë“ ë‹¤.
2. ì–´ë³´íŠ¸ëœ íŠ¸ëžœìž­ì…˜ì´ ì“´ ë°ì´í„°ëŠ” ëª¨ë‘ ë¬´ì‹œëœë‹¤.
3. íŠ¸ëžœìž­ì…˜ IDê°€ ë” í°(ì¦‰ í˜„ìž¬ íŠ¸ëžœìž­ì…˜ì´ ì‹œìž‘í•œ í›„ì— ì‹œìž‘í•œ) íŠ¸ëžœìž­ì…˜ì´ ì“´ ë°ì´í„°ëŠ” ê·¸ íŠ¸ëžœìž­ì…˜ì˜ ì»¤ë°‹ ì—¬ë¶€ì— ê´€ê³„ ì—†ì´ ëª¨ë‘ ë¬´ì‹œëœë‹¤.
4. ê·¸ ë°–ì˜ ëª¨ë“  ë°ì´í„°ëŠ” Applicationì˜ ì§ˆì˜ë¡œ ë³¼ ìˆ˜ ìžˆë‹¤.
```

- ìœ„ ê·œì¹™ë“¤ì€ ê°ì²´ ìƒì„±ê³¼ ì‚­ì œ ëª¨ë‘ì— ì ìš©
- ì´ë¡œ ì¸í•´ ì¼ê´€ëœ ìŠ¤ëƒ…ìˆì„ Applicationì— ì œê³µ
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ê°±ì‹ í•  ë•Œ ê°’ì„ êµì²´í•˜ì§€ ì•Šê³  ê°’ì´ ë°”ë€” ë•Œë§ˆë‹¤ ìƒˆ ë²„ì „ì„ ìƒì„±í•¨

#### ðŸ›  7.2.2.3 ìƒ‰ì¸ê³¼ ìŠ¤ëƒ…ìˆ ê²©ë¦¬

- PostgreSQL
  - ë™ì¼í•œ ê°ì²´ì˜ ë‹¤ë¥¸ ë²„ì „ë“¤ì´ ê°™ì€ íŽ˜ì´ì§€ì— ì €ìž¥ë  ìˆ˜ ìžˆë‹¤ë©´ ìƒ‰ì¸ ê°±ì‹ ì„ íšŒí”¼
- ì¹´ìš°ì¹˜DB, LMDB, ë°ì´í† ë¯¹
  - íŠ¸ë¦¬ì˜ íŽ˜ì´ì§€ê°€ ê°±ì‹ ë  ë•Œ ê° ë³€ê²½ëœ íŽ˜ì´ì§€ì˜ ë³µì‚¬ë³¸ì„ ìƒì„±
  - append-only/copy-on-write
- oracle
  - ë™ì¼í•œ ê°ì²´ì˜ ë‹¤ë¥¸ ë²„ì „ë“¤ì´ ê°™ì€ íŽ˜ì´ì§€ì— ì €ìž¥ë  ìˆ˜ ìžˆë‹¤ë©´ ìƒ‰ì¸ ê°±ì‹ ì„ íšŒí”¼
  - PostgreSQLì™€ ë‹¤ë¥¸ ì ì€ SCN(System Change Number)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì¸ë±ìŠ¤ì˜ ìƒíƒœë¥¼ íŒë‹¨

#### ðŸ›  7.2.2.4 ë°˜ë³µ ì½ê¸°ì™€ í˜¼ëž€ìŠ¤ëŸ¬ìš´ ì´ë¦„

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ëŠ” ì—¬ëŸ¬ ëª…ì¹­ì´ í˜¼ìž¬ë˜ì–´ ì‚¬ìš©

- ì§ë ¬ì„±
  - oracle
- ë°˜ë³µì½ê¸°(repeatable read)
  - MySQL, PostgreSQL

SQL í‘œì¤€ì˜ ê²©ë¦¬ ìˆ˜ì¤€ ì •ì˜ì—ëŠ” ê²°í•¨ì´ ìžˆê³ , ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì˜ ê°œë…ì´ ì—†ê¸° ë•Œë¬¸

### ðŸ”– 7.2.3 ê°±ì‹  ì†ì‹¤ ë°©ì§€

#### ê°±ì‹  ì†ì‹¤

- Applicationì´ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ê°’ì„ ì½ê³  ë³€ê²½í•œ í›„ ë³€ê²½ëœ ê°’ì„ ë‹¤ì‹œ ì“¸ ë•Œ(read-modify-write) ë°œìƒ
- ë‘ íŠ¸ëžœìž­ì…˜ì´ ë™ì‹œì— read-modify-writeë¥¼ í•˜ë©´ ë‘ ë²ˆì§¸ ì“°ê¸° ìž‘ì—…ì´ ì²« ë²ˆì§¸ ë³€ê²½ì„ í¬í•¨í•˜ì§€ ì•Šì•„ ì†ì‹¤

#### ðŸ›  7.2.3.1 ì›ìžì  ì“°ê¸° ì—°ì‚°

```sql
UPDATE counters
SET value = value + 1
WHERE key = 'foo';
```

- read-modify-write ì£¼ê¸°ë¥¼ êµ¬í˜„í•  í•„ìš” ì—†ìŒ
- ëŒ€ë¶€ë¶„ì˜ RDBì—ì„œ ë™ì‹œì„± ì•ˆì „(concurrency-safe)
- ì»¤ì„œ ì•ˆì „ì„±(cursor stability)
  - ê°ì²´ë¥¼ ì½ì„ ë•Œ ë…ì ì ì¸(exclusive) ìž ê¸ˆì„ íšë“í•˜ì—¬ ê°±ì‹ ì´ ì ìš©ë  ë•Œê¹Œì§€ ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì—ì„œ ì½ì§€ ëª»í•˜ê²Œ í•¨.

#### ðŸ›  7.2.3.2 ëª…ì‹œì ì¸ ìž ê¸ˆ

```sql
SELECT /* ëª…ì‹œì ì¸ ìž ê¸ˆ */ * 
FROM FIGURES
WHERE NAME = 'ROBOT'
AND GAME_ID = 222
FOR UPDATE;

UPDATE FIGURES
SET POSITION = 'C4'
WHERE ID = 1234;
```

- Application ì—ì„œ ê°±ì‹ í•  ê°ì²´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ìž ê¸ˆ

#### ðŸ›  7.2.3.3 ê°±ì‹  ì†ì‹¤ ìžë™ ê°ì§€

- ê°±ì‹  ì†ì‹¤ì„ ë°œê²¬í•˜ë©´ íŠ¸ëžœìž­ì…˜ì„ ì–´ë³´íŠ¸ì‹œí‚¤ê³  read-modify-write ì£¼ê¸°ë¥¼ ìž¬ì‹œë„í•˜ë„ë¡ ê°•ì œí•˜ëŠ” ë°©ë²•
  - Oracle, PostgreSQL ì œê³µ
  - MySQL ë¯¸ì œê³µ
- Application codeì—ì„œ DB ê¸°ëŠ¥ì„ ì“°ì§€ ì•Šì•„ë„ ë˜ë¯€ë¡œ ì¢‹ìŒ

#### ðŸ›  7.2.3.4 Compare-and-set

```sql
UPDATE /* ìœ„í‚¤íŽ˜ì´ì§€ê°€ ì´ì „ ê°’ê³¼ ë™ì¼í•œ ê²½ìš° ê°±ì‹  í—ˆìš© */ WIKI_PAGES
SET CONTENT = 'NEW CONTENT'
WHERE ID = 1234
AND CONTENT = 'OLD CONTENT'
```

- ê°’ì„ ë§ˆì§€ë§‰ìœ¼ë¡œ ì½ì€ í›„ë¡œ ë³€ê²½ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ ê°±ì‹ ì„ í—ˆìš©í•˜ì—¬ ê°±ì‹  ì†ì‹¤ ë°©ì§€
- ë‹¤ë§Œ where ì ˆì´ ì˜¤ëž˜ëœ ìŠ¤ëƒ…ìˆìœ¼ë¡œë¶€í„° ì½ëŠ”ë‹¤ë©´ ê°±ì‹  ì†ì‹¤ì´ ì¼ì–´ë‚  ìˆ˜ ìžˆë‹¤.

#### ðŸ›  7.2.3.5 ì¶©ëŒ í•´ì†Œì™€ ë³µì œ

- ë³µì œê°€ ì ìš©ëœ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” ì“°ê¸°ê°€ ë™ì‹œì— ì‹¤í–‰ë  ë•Œ í•œ ê°’ì— ëŒ€í•´ ì—¬ëŸ¬ ê°œì˜ ì¶©ëŒëœ ë²„ì „(sibling)ì„ ìƒì„±í•˜ëŠ” ê²ƒì„ í—ˆìš©í•˜ê³  ì‚¬í›„ì— ì¶©ëŒ í•´ì†Œ í›„ ë³‘í•©í•œë‹¤.
- ìµœì¢… ì“°ê¸° ìŠ¹ë¦¬(last write wins, LWW) ì¶©ëŒ í•´ì†Œ ë°©ë²•ì€ ê°±ì‹  ì†ì‹¤ì´ ë°œìƒí•˜ê¸° ì‰½ë‹¤.

### ðŸ”– 7.2.4 ì“°ê¸° ìŠ¤íì™€ íŒ¬í…€

#### ðŸ›  7.2.4.1 ì“°ê¸° ìŠ¤íë¥¼ íŠ¹ì§•ì§“ê¸°

![7-8](./img/7-8.png)

- on-call ë‹´ë‹¹ì´ 1ëª…ì´ ìžˆì–´ì•¼ í•˜ëŠ”ë° 0ëª…ì´ ë˜ì–´ë²„ë¦¼.
- ë‘ íŠ¸ëžœìž­ì…˜ì´ ê°™ì€ ê°ì²´ë¥¼ ì½ì–´ ê·¸ ì¤‘ ì¼ë¶€ë¥¼ ê°±ì‹ í•  ë•Œ ë‚˜íƒ€ë‚  ìˆ˜ ìžˆëŠ” ì •ì±…ì ì¸ ìœ„ë°˜ ì‚¬í•­

##### ì“°ê¸° ìŠ¤í ë°©ì§€

1. ë‹¤ì¤‘ ê°ì²´ê°€ ì—°ê´€ë˜ë¯€ë¡œ ì›ìžì  ë‹¨ì¼ ê°ì²´ ì—°ì‚°ì€ ë„ì›€ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤.
2. ì§ë ¬ì„± ê²©ë¦¬ê°€ í•„ìš”
3. ì—¬ëŸ¬ ê°ì²´ì™€ ì—°ê´€ëœ ì œì•½ ì¡°ê±´ ì„¤ì •
4. ëª…ì‹œì ì¸ ìž ê¸ˆ

```sql
SELECT /* ëª…ì‹œì ì¸ ìž ê¸ˆ */ * 
FROM DOCTORS
WHERE ON_CALL = TRUE
AND SHIFT_ID = 1234
FOR UPDATE;

UPDATE DOCTORS
SET ON_CALL = FALSE
WHERE NAME = 'ALICE'
AND SHIFT_ID = 1234;
```

#### ðŸ›  7.2.4.2 ì¶”ê°€ì ì¸ ì“°ê¸° ìŠ¤íì˜ ì˜ˆ

##### íšŒì˜ì‹¤ ì˜ˆì•½ ì‹œìŠ¤í…œ

```sql
-- ì •ì˜¤ì—ì„œ ì˜¤í›„ 1ì‹œê¹Œì§€ì˜ ì‹œê°„ê³¼ ê²¹ì¹˜ëŠ” ì˜ˆì•½ì´ ì¡´ìž¬í•˜ëŠ”ì§€ í™•ì¸
SELECT COUNT(*)
FROM BOOKINGS
WHERE ROOM_ID = 123
AND END_TIME > '2015-01-01 12:00' AND START_TIME < '2015-01-01 13:00'

-- ì´ì „ ì§ˆì˜ê°€ 0ì„ ë°˜í™˜í–ˆë‹¤ë©´
INSERT INTO BOOKINGS
(ROOM_ID, START_TIME, END_TIME, USER_ID)
VALUES (123, '2015-01-01 12:00', '2015-01-01 13:00', 666)
```

- ë™ì‹œì— ê°™ì€ íšŒì˜ì‹¤ì„ ì¤‘ë³µ ì˜ˆì•½í•  ìˆ˜ ì—†ê²Œ í•˜ê³  ì‹¶ë‹¤. ëˆ„êµ°ê°€ ì˜ˆì•½ì„ í•˜ë ¤ê³  í•  ë•Œ ë¨¼ì € ì¶©ëŒí•˜ëŠ” ì˜ˆì•½ì´ ìžˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì—†ë‹¤ë©´ íšŒì˜ë¥¼ ì˜ˆì•½í•œë‹¤.

##### ì‚¬ìš©ìžëª… íšë“

- ê° ì‚¬ìš©ìžê°€ ìœ ì¼í•œ ì‚¬ìš©ìžëª…ì„ ê°€ì ¸ì•¼ í•˜ëŠ” ì›¹ì‚¬ì´íŠ¸ì—ì„œ ë‘ ëª…ì˜ ì‚¬ìš©ìžê°€ ë™ì‹œì— ê°™ì€ ì‚¬ìš©ìžëª…ìœ¼ë¡œ ê³„ì • ìƒì„±ì„ ì‹œë„í•  ìˆ˜ ìžˆë‹¤.
  - ì´ ê²½ìš°ëŠ” ìœ ì¼ì„± ì œì•½ ì¡°ê±´ì´ ê°„ë‹¨í•œ í•´ê²°ì±…

#### ðŸ›  7.2.4.3 ì“°ê¸° ìŠ¤íë¥¼ ìœ ë°œí•˜ëŠ” íŒ¬í…€

##### íŒ¬í…€

- ì–´ë–¤ íŠ¸ëžœìž­ì…˜ì—ì„œ ì‹¤í–‰í•œ ì“°ê¸°ê°€ ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì˜ ê²€ìƒ‰ ì§ˆì˜ ê²°ê³¼ë¥¼ ë°”ê¾¸ëŠ” íš¨ê³¼
- ì˜ˆë¥¼ë“¤ì–´, í•œ íŠ¸ëžœìž­ì…˜ë‚´ì—ì„œ ë‘ ë²ˆ ì¡°íšŒí–ˆëŠ”ë° ê°ê°ì˜ ê²°ê³¼ê°€ ë‹¤ë¥¸ ê²½ìš°
  - ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì—ì„œ CUD íŠ¸ëžœìž­ì…˜ì„ ì»¤ë°‹í•˜ì—¬ ì¤‘ê°„ì— ì§ˆì˜ ê²°ê³¼ê°€ ë‹¬ë¼ì§

#### ðŸ›  7.2.4.4 ì¶©ëŒ êµ¬ì²´í™”

- íŒ¬í…€ì˜ ë¬¸ì œëŠ” ê²°êµ­ ìž ê¸€ ìˆ˜ ìžˆëŠ” ê°ì²´ê°€ ì—†ë‹¤ëŠ” ê²ƒì— ì°©ì•ˆí•´ ì¸ìœ„ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ìž ê¸ˆ ê°ì²´ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒ
- íšŒì˜ì‹¤ ì˜ˆì•½ì˜ ê²½ìš° íšŒì˜ì‹¤ê³¼ ì‹œê°„ì— ëŒ€í•œ ëª¨ë“  ì¡°í•©ì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ ìž ê¸ˆì— ì‚¬ìš©
- ì¶©ëŒ êµ¬ì²´í™” ë°©ë²•ì€ ì•Œì•„ë‚´ê¸° ì–´ë µê³  ì˜¤ë¥˜ ë°œìƒí™•ë¥ ì´ ë†’ë‹¤.

## ðŸ“– 7.3 ì§ë ¬ì„±(Serializable)

- ê°€ìž¥ ê°•ë ¥í•œ ê²©ë¦¬ ìˆ˜ì¤€
- ì—¬ëŸ¬ íŠ¸ëžœìž­ì…˜ì´ ë³‘ë ¬ë¡œ ì‹¤í–‰ë˜ë”ë¼ë„ ìµœì¢… ê²°ê³¼ëŠ” ë™ì‹œì„± ì—†ì´ í•œ ë²ˆì— í•˜ë‚˜ì”© **ì§ë ¬**ë¡œ ì‹¤í–‰ë  ë•Œì™€ ê°™ë„ë¡ ë³´ìž¥
- ë°ì´í„°ë² ì´ìŠ¤ê°€ ë°œìƒí•  ìˆ˜ ìžˆëŠ” **ëª¨ë“ ** ê²½ìŸ ì¡°ê±´ì„ ë§‰ì•„ì¤Œ

### ðŸ”– 7.3.1 ì‹¤ì œì ì¸ ì§ë ¬ ì‹¤í–‰

ë™ì‹œì„± ë¬¸ì œë¥¼ í”¼í•˜ëŠ” ê°€ìž¥ ê°„ë‹¨í•œ ë°©ë²•ì€ í•œ ë²ˆì— íŠ¸ëžœìž­ì…˜ í•˜ë‚˜ì”©ë§Œ ì§ë ¬ë¡œ ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰í•˜ë©´ ëœë‹¤.

ì˜ì™¸ë¡œ ë‹¨ì¼ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ë˜ë„ë¡ ì„¤ê³„ëœ ì‹œìŠ¤í…œì´ ë™ì‹œì„±ì„ ì§€ì›í•˜ëŠ” ì‹œìŠ¤í…œë³´ë‹¤ ì„±ëŠ¥ì´ ë‚˜ì„ ë•Œë„ ìžˆë‹¤.

- ìž ê¸ˆì„ ì½”ë””ë„¤ì´ì…˜í•˜ëŠ” ì˜¤ë²„í—¤ë“œë¥¼ í”¼í•  ìˆ˜ ìžˆê¸° ë•Œë¬¸
- ë‹¤ë§Œ ì²˜ë¦¬ëŸ‰ì´ CPU ì½”ì–´ í•˜ë‚˜ì˜ ì²˜ë¦¬ëŸ‰ìœ¼ë¡œ ì œí•œë˜ì–´ìžˆìœ¼ë¯€ë¡œ íŠ¸ëžœìž­ì…˜ì´ ì „í†µì ì¸ í˜•íƒœì™€ëŠ” ë‹¤ë¥´ê²Œ êµ¬ì¡°í™”ë¼ì•¼ í•œë‹¤.

#### ðŸ›  7.3.1.1 íŠ¸ëžœìž­ì…˜ì„ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € ì•ˆì— ìº¡ìŠí™”í•˜ê¸°

ì´ˆì°½ê¸°ì—ëŠ” ë°ì´í„°ë² ì´ìŠ¤ íŠ¸ëžœìž­ì…˜ì´ ì‚¬ìš©ìž í™œë™ì˜ ì „ì²´ íë¦„ì„ í¬í•¨í•  ìˆ˜ ìžˆê²Œ í•˜ë ¤ëŠ” ì˜ë„ê°€ ìžˆì—ˆë‹¤.(í•­ê³µê¶Œ ì˜ˆì•½ì˜ ì „ì²´ê³¼ì • ë“±)

- ì´ ê²½ìš°, íŠ¸ëžœìž­ì…˜ì´ ì‚¬ìš©ìžì˜ ìž…ë ¥ì„ ê¸°ë‹¤ë¦¬ê²Œ ë˜ê³  ë§¤ìš° ë§Žì€ ë™ì‹œ ì‹¤í–‰ íŠ¸ëžœìž­ì…˜ì„ ì§€ì›í•´ì•¼ í•¨.

ê²°êµ­, ëŒ€ë¶€ë¶„ì˜ OLTP Applicationì€ íŠ¸ëžœìž­ì…˜ ë‚´ì—ì„œ ëŒ€í™”ì‹ìœ¼ë¡œ ì‚¬ìš©ìž ì‘ë‹µì„ ëŒ€ê¸°í•˜ëŠ” ê²ƒì„ íšŒí”¼í•¨ìœ¼ë¡œì¨ íŠ¸ëžœìž­ì…˜ì„ ì§§ê²Œ ìœ ì§€í•œë‹¤.

- ì‚¬ëžŒì´ ì£¼ìš” ê²½ë¡œ(critical path)ì—ì„œ ì œì™¸ëìŒì—ë„ íŠ¸ëžœìž­ì…˜ì€ ê³„ì† ìƒí˜¸ìž‘ìš©í•˜ëŠ” client/server ìŠ¤íƒ€ì¼ë¡œ ì‹¤í–‰ë¼ ì™”ë‹¤.
  - ex) Application <-> DB ê°„ì— ì§ˆì˜ ì‹¤í–‰ ë° ê²°ê³¼ ì‘ë‹µí•˜ëŠ” êµ¬ì¡°
- ì´ëŸ¬í•œ ìƒí˜¸ìž‘ìš©ì‹ íŠ¸ëžœìž­ì…˜ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ê³¼ ë°ì´í„°ë² ì´ìŠ¤ ì‚¬ì´ì˜ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì— ë§Žì€ ì‹œê°„ì„ ì†Œë¹„í•¨. ë§Œì•½ ë™ì‹œì„±ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì„±ëŠ¥ì€ ìµœì•…ì´ ë  ê²ƒì´ë‹¤.
  - ë”°ë¼ì„œ, ì§ë ¬ì„± ê²©ë¦¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‹œìŠ¤í…œë“¤ì€ ìƒí˜¸ìž‘ìš©í•˜ëŠ” ë‹¤ì¤‘ êµ¬ë¬¸ íŠ¸ëžœìž­ì…˜ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  Applicationì€ íŠ¸ëžœìž­ì…˜ ì½”ë“œ ì „ì²´ë¥¼ **ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €** í˜•íƒœë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë¯¸ë¦¬ ì œì¶œí•´ì•¼ í•œë‹¤.

![7-9](./img/7-9.png)

#### ðŸ›  7.3.1.2 ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì˜ ìž¥ë‹¨ì 

##### ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì˜ ë‹¨ì 

- ë°ì´í„°ë² ì´ìŠ¤ ë²¤ë”ë§ˆë‹¤ ê°ê°ì˜ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ìš© ì–¸ì–´ê°€ ìžˆëŠ”ë° ë§¤ìš° ë‚¡ê³  ìƒíƒœê³„ê°€ ë¹ˆì•½í•˜ë‹¤.
  - oracle: PL/SQL ë“±
- ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì‹¤í–‰ë˜ëŠ” ì½”ë“œëŠ” ê´€ë¦¬í•˜ê¸° ì–´ë µë‹¤.
  - í˜•ìƒ ê´€ë¦¬, ë°°í¬, ëª¨ë‹ˆí„°ë§ ì§€í‘œ ìˆ˜ì§‘ ë“±
- ë°ì´í„°ë² ì´ìŠ¤ëŠ” ì„œë²„ë³´ë‹¤ í›¨ì”¬ ë” ì„±ëŠ¥ì— ë¯¼ê°í•  ë•Œê°€ ë§Žë‹¤.

##### ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ì˜ ìž¥ì 

- í˜„ëŒ€ì˜ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì € êµ¬í˜„ì€ ê¸°ì¡´ì˜ ë²”ìš© í”„ë¡œê·¸ëž˜ë° ì–¸ì–´(java, groovy ë“±)
- I/O ëŒ€ê¸°ê°€ í•„ìš” ì—†ê³  ë‹¨ì¼ ìŠ¤ë ˆë“œë¡œ ìƒë‹¹ížˆ ì¢‹ì€ ì²˜ë¦¬ëŸ‰ì„ ì–»ì„ ìˆ˜ ìžˆë‹¤.
- ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ëŠ” ì„œë²„ì—ì„œ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì—, ë°ì´í„°ë² ì´ìŠ¤ì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ë„¤íŠ¸ì›Œí¬ ë¶€í•˜â¬‡ï¸ ë³´ì•ˆì„± â¬†ï¸
- Applicationì—ì„œ ìžì£¼ ë¡œì§ì´ë‚˜ ì¿¼ë¦¬ë¥¼ ìŠ¤í† ì–´ë“œ í”„ë¡œì‹œì €ë¡œ ìž‘ì„±í•˜ì—¬ ê´€ë¦¬í•˜ë©´, ì„±ëŠ¥ í–¥ìƒê³¼ ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•¨.

#### ðŸ›  7.3.1.3 íŒŒí‹°ì…”ë‹

ì§ë ¬ì„± ê²©ë¦¬ì˜ ê²½ìš° ê²°êµ­ ë‹¨ì¼ CPU ì½”ì–´ì˜ ì†ë„ë¡œ ì œí•œëœë‹¤. ì´ë¥¼ ìœ„í•´ ì—¬ëŸ¬ CPU ì½”ì–´ì™€ ì—¬ëŸ¬ ë…¸ë“œë¡œ í™•ìž¥í•˜ê¸° ìœ„í•´ ë°ì´í„°ë¥¼ íŒŒí‹°ì…”ë‹í•  ìˆ˜ë„ ìžˆë‹¤.

- ì—¬ëŸ¬ íŒŒí‹°ì…˜ì— ì ‘ê·¼í•´ì•¼ í•˜ëŠ” íŠ¸ëžœìž­ì…˜ì´ ìžˆë‹¤ë©´ ë°ì´í„°ë² ì´ìŠ¤ê°€ í•´ë‹¹ íŠ¸ëžœìž­ì…˜ì´ ì ‘ê·¼í•˜ëŠ” ëª¨ë“  íŒŒí‹°ì…˜ì— ê±¸ì³ì„œ ì½”ë””ë„¤ì´ì…˜ì„ í•´ì•¼í•œë‹¤. ì´ëŠ” ë‹¨ì¼ íŒŒí‹°ì…˜ íŠ¸ëžœìž­ì…˜ë³´ë‹¤ ì—„ì²­ë‚˜ê²Œ ëŠë¦¬ë‹¤.

#### ðŸ›  7.3.1.4 ì§ë ¬ ì‹¤í–‰ ìš”ì•½

1. ëª¨ë“  íŠ¸ëžœìž­ì…˜ì€ ìž‘ê³  ë¹¨ë¼ì•¼í•œë‹¤. ëŠë¦° íŠ¸ëžœìž­ì…˜ í•˜ë‚˜ê°€ ëª¨ë“  íŠ¸ëžœìž­ì…˜ ì²˜ë¦¬ë¥¼ ì§€ì—°ì‹œí‚¬ ìˆ˜ ìžˆê¸° ë•Œë¬¸ì´ë‹¤.
2. í™œì„±í™”ëœ ë°ì´í„°ì…‹ì´ ë©”ëª¨ë¦¬ì— ì ìž¬ë  ìˆ˜ ìžˆëŠ” ê²½ìš°ë¡œ ì‚¬ìš©ì´ ì œí•œëœë‹¤.
3. ì“°ê¸° ì²˜ë¦¬ëŸ‰ì´ ë‹¨ì¼ CPU ì½”ì–´ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìžˆì„ ì •ë„ë¡œ ì¶©ë¶„ížˆ ë‚®ì•„ì•¼ í•œë‹¤.
4. ì—¬ëŸ¬ íŒŒí‹°ì…˜ì— ê±¸ì¹œ íŠ¸ëžœìž­ì…˜ë„ ì“¸ ìˆ˜ ìžˆì§€ë§Œ ì´ê²ƒì„ ì‚¬ìš©í•  ìˆ˜ ìžˆëŠ” ì •ë„ì—ëŠ” ì—„ê²©í•œ ì œí•œì´ ìžˆë‹¤.

### ðŸ”– 7.3.2 2ë‹¨ê³„ ìž ê¸ˆ(2PL)

2PLì€ 2ë‹¨ê³„ë¡œ ë‚˜ë‰œë‹¤.

- 1ë‹¨ê³„(Growing Phase): ì´ ë‹¨ê³„ì—ì„œëŠ” ì˜¤ì§ ìž ê¸ˆì„ íšë“í•  ìˆ˜ ìžˆê³ , í•´ì œí•  ìˆ˜ëŠ” ì—†ë‹¤.
- 2ë‹¨ê³„(Shrinking Phase): ì´ ë‹¨ê³„ì—ì„œëŠ” íŠ¸ëžœìž­ì…˜ì´ ìž ê¸ˆì„ í•´ì œí•  ìˆ˜ëŠ” ìžˆì§€ë§Œ ìƒˆë¡œìš´ ìž ê¸ˆì„ íšë“í•˜ì§€ëŠ” ëª»í•œë‹¤.

ìŠ¤ëƒ…ìˆ ê²©ë¦¬ëŠ” ì½ëŠ” ìª½ì€ ì“°ëŠ” ìª½ì„ ë§‰ì§€ ì•Šìœ¼ë©° ì“°ëŠ” ìª½ë„ ì½ëŠ” ìª½ì„ ë§‰ì§€ ì•ŠëŠ”ë‹¤.
ë°˜ë©´, 2PLì€ ì“°ê¸° íŠ¸ëžœìž­ì…˜ì€ ë‹¤ë¥¸ ì“°ê¸° íŠ¸ëžœìž­ì…˜ ë¿ ì•„ë‹ˆë¼ ì½ê¸° íŠ¸ëžœìž­ì…˜ë„ ì§„í–‰í•˜ì§€ ëª»í•˜ê²Œ ë§‰ìœ¼ë©°, ì§ë ¬ì„±ì„ ì œê³µí•˜ì—¬ ëª¨ë“  ê²½ìŸ ì¡°ê±´ìœ¼ë¡œë¶€í„° ë³´í˜¸í•´ì¤€ë‹¤.

#### ðŸ›  7.3.2.1 2ë‹¨ê³„ ìž ê¸ˆ êµ¬í˜„

1. íŠ¸ëžœìž­ì…˜ì´ ê°ì²´ë¥¼ ì½ê¸°ë¥¼ ì›í•œë‹¤ë©´ ë¨¼ì € ê³µìœ  ëª¨ë“œë¡œ ìž ê¸ˆì„ íšë“í•´ì•¼ í•¨. ë‹¤ë§Œ ë…ì  ëª¨ë“œë¡œ ìž ê¸ˆì„ íšë“í•œ íŠ¸ëžœìž­ì…˜ì´ ìžˆìœ¼ë©´ ì´ íŠ¸ëžœìž­ì…˜ì´ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤. ë™ì‹œì— ê³µìœ  ëª¨ë“œë¡œ ìž ê¸ˆì„ íšë“í•˜ëŠ” ê²ƒì€ í—ˆìš©
2. íŠ¸ëžœìž­ì…˜ì´ ê°ì²´ì— ì“°ê¸°ë¥¼ ì›í•œë‹¤ë©´ ë…ì  ëª¨ë“œë¡œ ìž ê¸ˆì„ íšë“í•´ì•¼ í•¨.
3. íŠ¸ëžœìž­ì…˜ì´ ì½ë‹¤ê°€ ì“°ê¸°ë¥¼ ì‹¤í–‰í•  ë•ŒëŠ” ê³µìœ  ìž ê¸ˆì„ ë…ì  ìž ê¸ˆìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ í•´ì•¼ í•œë‹¤.
4. íŠ¸ëžœìž­ì…˜ì´ ìž ê¸ˆì„ íšë“í•œ í›„ì—ëŠ” íŠ¸ëžœìž­ì…˜ì´ ì¢…ë£Œ(commit or abort)ë  ë•Œê¹Œì§€ ìž ê¸ˆì„ ê°–ê³  ìžˆì–´ì•¼ í•œë‹¤.

ì„œë¡œ ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì´ ìž ê¸ˆì„ íšë“í•˜ê¸° ìœ„í•´ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœë¥¼ **êµì°©ìƒíƒœ**ë¼ê³  í•œë‹¤.

#### ðŸ›  7.3.2.2 2ë‹¨ê³„ ìž ê¸ˆì˜ ì„±ëŠ¥

2PLì˜ ê°€ìž¥ í° ì•½ì ì€ ì„±ëŠ¥ì´ë‹¤.

- ìž ê¸ˆì„ íšë“í•˜ê³  í•´ì œí•˜ëŠ” ì˜¤ë²„í—¤ë“œ
- ëŒ€ë¶€ë¶„ì˜ RDBë“¤ì€ íŠ¸ëžœìž­ì…˜ì˜ ì‹¤í–‰ ì‹œê°„ì„ ì œí•œí•˜ì§€ ì•ŠìŒ. ë”°ë¼ì„œ ì–¼ë§ˆë‚˜ ì˜¤ëž˜ ê¸°ë‹¤ë ¤ì•¼í•˜ëŠ”ì§€ ëª¨ë¦„.
- êµì°© ìƒíƒœë¡œ ì¸í•´ abort ë˜ì–´ ìž¬ì‹œë„í•˜ë©´ ìž‘ì—…ì„ ì „ë¶€ ìž¬ì‹œë„í•´ì•¼í•¨.

#### ðŸ›  7.3.2.3 ì„œìˆ  ìž ê¸ˆ

íŒ¬í…€ì„ ë§‰ê¸° ìœ„í•´ ì„œìˆ  ìž ê¸ˆ(predicate lock)ì´ í•„ìš”í•˜ë‹¤.

```sql
SELECT /* ì„œìˆ ìž ê¸ˆ ê°€ëŠ¥í•œ ê°ì²´ */*
FROM BOOKINGS
WHERE ROOM_ID = 123
AND END_TIME > '2018-01-01 12:00'
AND START_TIME < '2018-01-01 13:00';
```

- ê³µìœ /ë…ì  ìž ê¸ˆê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ íŠ¹ì • ê°ì²´ì— ì†í•˜ì§€ ì•Šê³  ìœ„ ì¿¼ë¦¬ì™€ ê°™ì´ ì–´ë–¤ ê²€ìƒ‰ì¡°ê±´ì— ë¶€í•©í•˜ëŠ” ëª¨ë“  ê°ì²´ì— ì†í•œë‹¤.
- ì„œìˆ  ìž ê¸ˆì€ ì•„ì§ ì¡´ìž¬í•˜ì§€ ì•Šì§€ë§Œ ë¯¸ëž˜ì— ì¶”ê°€ë  ìˆ˜ ìžˆëŠ” ê°ì²´(íŒ¬í…€)ì—ë„ ì ìš©í•  ìˆ˜ ìžˆë‹¤ëŠ” ê²ƒì´ í•µì‹¬ ì•„ì´ë””ì–´ë‹¤.
- 2PLì´ ì„œìˆ  ìž ê¸ˆì„ í¬í•¨í•˜ë©´ ë¹„ë¡œì†Œ ì§ë ¬ì„± ê²©ë¦¬ê°€ ëœë‹¤.
ì„œìˆ  ìž ê¸ˆì€ íŠ¸ëžœìž­ì…˜ë“¤ì´ íšë“í•œ ìž ê¸ˆì´ ë§Žìœ¼ë©´ ì¡°ê±´ í™•ì¸ì— ì‹œê°„ì´ ì˜¤ëž˜ ê±¸ë¦°ë‹¤.

#### ðŸ›  7.3.2.3 ìƒ‰ì¸ ë²”ìœ„ ìž ê¸ˆ

ëŒ€ë¶€ë¶„ì˜ 2PLì„ ì§€ì›í•˜ëŠ” DBëŠ” ìƒ‰ì¸ ë²”ìœ„ ìž ê¸ˆ(index-range locking, ë‹¤ìŒ í‚¤ ìž ê¸ˆ(next-key locking))ì„ êµ¬í˜„í•œë‹¤.

- ì´ëŠ” ì„œìˆ  ìž ê¸ˆì„ ê·¼ì‚¬í™” í•œ ê²ƒì´ë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, ìœ„ì˜ ì¿¼ë¦¬ì—ì„œ 123ë²ˆ ë°©ë§Œ ìž ê¸ˆí•˜ëŠ” ê²ƒì´ì•„ë‹Œ ì‹œê°„ëŒ€ì— ì†í•œ ëª¨ë“  ë°©ì„ ìž ê¸ˆ
- ì´ ë°©ë²•ì€ ì„œìˆ  ìž ê¸ˆë³´ë‹¤ ì •ë°€í•˜ì§„ ì•Šì§€ë§Œ ì˜¤ë²„í—¤ë“œê°€ í›¨ì”¬ ë‚®ë‹¤.
- ì í•©í•œ indexê°€ ì—†ë‹¤ë©´ í…Œì´ë¸” ì „ì²´ì— ê³µìœ  ìž ê¸ˆì„ ìž¡ëŠ” ê²ƒìœ¼ë¡œ ëŒ€ì²´í•  ìˆ˜ ìžˆë‹¤.

### ðŸ”– 7.3.3 ì§ë ¬ì„± ìŠ¤ëƒ…ìˆ ê²©ë¦¬(SSI)

- ì§ë ¬ì„± ê²©ë¦¬ì™€ ì¢‹ì€ ì„±ëŠ¥ì˜ ê³µì¡´ì„ ìœ„í•´ ë‚˜íƒ€ë‚¨.
- ì™„ì „í•œ ì§ë ¬ì„±ì„ ì œê³µí•˜ì§€ë§Œ ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì— ë¹„í•´ ì•½ê°„ì˜ ì„±ëŠ¥ ì†í•´ë§Œ ìžˆìŒ.

#### ðŸ›  7.3.3.1 ë¹„ê´€ì  ë™ì‹œì„± ì œì–´ ëŒ€ ë‚™ê´€ì  ë™ì‹œì„± ì œì–´

##### ë¹„ê´€ì  ë™ì‹œì„± ì œì–´

- ìž˜ëª»ë  ê°€ëŠ¥ì„±ì´ ìžˆìœ¼ë©´ ë­”ê°€ë¥¼ í•˜ê¸° ì „ì— ìƒí™©ì´ ë‹¤ì‹œ ì•ˆì „í•´ì§ˆ ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼
- ìƒí˜¸ ë°°ì œ(mutual exclusion)ì™€ ë¹„ìŠ·í•¨
- 2PL

##### ë‚™ê´€ì  ë™ì‹œì„± ì œì–´

- ìœ„í—˜í•œ ìƒí™©ì´ ë°œìƒí•  ê°€ëŠ¥ì„±ì´ ìžˆì–´ë„ íŠ¸ëžœìž­ì…˜ì„ ë§‰ì§€ ì•Šê³  ê³„ì† ì§„í–‰
- íŠ¸ëžœìž­ì…˜ì´ ì»¤ë°‹ë˜ê¸°ë¥¼ ì›í•  ë•Œ ë°ì´í„°ë² ì´ìŠ¤ëŠ” ë‚˜ìœ ìƒí™©ì´ ë°œìƒí–ˆë‹¤ë©´ abortí•œë‹¤.
- íŠ¸ëžœìž­ì…˜ ê°„ì˜ ê²½ìŸì´ ì‹¬í•˜ë©´ abortì‹œì¼œì•¼ í•  íŠ¸ëžœìž­ì…˜ì˜ ë¹„ìœ¨ì´ ë†’ì•„ì§€ë¯€ë¡œ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤.
- ì˜ˆë¹„ ìš©ëŸ‰ì´ ì¶©ë¶„í•˜ê³  ê²½ìŸì´ ì‹¬í•˜ì§€ ì•Šìœ¼ë©´ ë¹„ê´€ì  ë™ì‹œì„± ì œì–´ë³´ë‹¤ ì„±ëŠ¥ì´ ì¢‹ë‹¤.
- SSI
  - ìŠ¤ëƒ…ìˆ ê²©ë¦¬ ìœ„ì— ì•Œê³ ë¦¬ì¦˜(ì“°ê¸° ìž‘ì—… ì‚¬ì´ì˜ ì§ë ¬ì„± ì¶©ëŒ ê°ì§€ ë° abortí•  íŠ¸ëžœìž­ì…˜ì„ ê²°ì •)ì„ ì¶”ê°€

#### ðŸ›  7.3.3.2 ë’¤ì²˜ì§„ ì „ì œì— ê¸°ë°˜í•œ ê²°ì •

íŠ¸ëžœìž­ì…˜ì€ ì–´ë–¤ ì „ì œ(íŠ¸ëžœìž­ì…˜ì„ ì‹œìž‘í•  ë•Œ ì°¸ì´ì—ˆë˜ ì‚¬ì‹¤(on-call ëŒ€ê¸° ì˜ì‚¬ëŠ” 2ëª…ì´ë‹¤))ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì–´ë–¤ ë™ìž‘ì„ í•œë‹¤. ë‚˜ì¤‘ì— í•´ë‹¹ íŠ¸ëžœìž­ì…˜ì´ ì»¤ë°‹í•˜ë ¤ê³  í•  ë•Œ ì›ëž˜ ë°ì´í„°ê°€ ë°”ë€Œì–´ì„œ ê·¸ ì „ì œê°€ ë” ì´ìƒ ì°¸ì´ ì•„ë‹ ìˆ˜ ìžˆë‹¤.

ì§ë ¬ì„± ê²©ë¦¬ë¥¼ ì œê³µí•˜ë ¤ë©´ ë’¤ì²˜ì§„ ì „ì œë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ìž‘í•˜ëŠ” ìƒí™©ì„ ê°ì§€í•˜ì—¬ì•¼ í•œë‹¤. ê·¸ ë°©ë²•ì€ ì•„ëž˜ì™€ ê°™ë‹¤.

- ì˜¤ëž˜ëœ(stable) MVCC ê°ì²´ ë²„ì „ì„ ì½ì—ˆëŠ”ì§€ ê°ì§€í•˜ê¸°
- ê³¼ê±°ì˜ ì½ê¸°ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì“°ê¸° ê°ì§€í•˜ê¸°

#### ðŸ›  7.3.3.3 ì˜¤ëž˜ëœ MVCC ì½ê¸° ê°ì§€í•˜ê¸°

![7-10](./img/7-10.png)

- íŠ¸ëžœìž­ì…˜ì´ MVCC ìŠ¤ëƒ…ìˆì—ì„œ ë’¤ì²˜ì§„ ê°’ì„ ì½ì—ˆëŠ”ì§€ ê°ì§€í•˜ê³  ì»¤ë°‹ëœ ê²Œ ìžˆë‹¤ë©´ ì–´ë³´íŠ¸í•œë‹¤.
  - ê°ì§€ëœ íŠ¸ëžœìž­ì…˜ì´ abortê°€ ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ê³ , ê°ì§€í•˜ëŠ” íŠ¸ëžœìž­ì…˜ì´ ì½ê¸° ì „ìš©ì¼ ìˆ˜ë„ ìžˆë‹¤. ë”°ë¼ì„œ ë¶ˆí•„ìš”í•œ abortë¥¼ í”¼í•˜ê¸° ìœ„í•´ ì»¤ë°‹ë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦°ë‹¤.

#### ðŸ›  7.3.3.4 ê³¼ê±°ì˜ ì½ê¸°ì— ì˜í–¥ì„ ë¯¸ì¹˜ëŠ” ì“°ê¸° ê°ì§€í•˜ê¸°

![7-11](./img/7-11.png)

- shift_idì— indexê°€ ìžˆë‹¤ë©´ íŠ¸ëžœìž­ì…˜ 42, 43ì´ ì´ ë°ì´í„°ë¥¼ ì½ì—ˆë‹¤ëŠ” ì‚¬ì‹¤ì„ ê¸°ë¡í•  ìˆ˜ ìžˆë‹¤.
- íŠ¸ëžœìž­ì…˜ì´ ì½ì€ ë°ì´í„°ê°€ ë” ì´ìƒ ìµœì‹ ì´ ì•„ë‹ˆë¼ê³  íŠ¸ëžœìž­ì…˜ì—ê²Œ ì•Œë ¤ì¤€ë‹¤.

#### ðŸ›  7.3.3.5 ì§ë ¬ì„± ìŠ¤ëƒ…ìˆ ê²©ë¦¬ì˜ ì„±ëŠ¥

- ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ë“¤ì´ ìž¡ê³  ìžˆëŠ” ìž ê¸ˆì„ ê¸°ë‹¤ë¦¬ëŠë¼ ì°¨ë‹¨ë  í•„ìš”ê°€ ì—†ë‹¤.
  - ì§ˆì˜ ì§€ì—° ì‹œê°„ ì˜ˆì¸¡ì´ ì‰½ê³ , ë³€ë™ì´ ì ìŒ.
- ë‹¨ì¼ CPU ì½”ì–´ì˜ ì²˜ë¦¬ëŸ‰ì— ì œí•œë˜ì§€ ì•ŠëŠ”ë‹¤.
- abortì˜ ë¹„ìœ¨ì´ SSIì˜ ì „ì²´ì ì¸ ì„±ëŠ¥ì— í° ì˜í–¥ì„ ë¯¸ì¹œë‹¤.
  - ì˜¤ëžœ ì‹œê°„ ë°ì´í„°ë¥¼ ì“°ëŠ” íŠ¸ëžœìž­ì…˜ì€ abortë‚˜ê¸° ì‰¬ìš°ë¯€ë¡œ, SSIëŠ” ì“°ê¸° íŠ¸ëžœìž­ì…˜ì´ ìƒë‹¹ížˆ ì§§ê¸°ë¥¼ ìš”êµ¬í•œë‹¤.

## ðŸ“– 7.4 ì •ë¦¬

___

íŠ¸ëžœìž­ì…˜ì€ Applicationì´ ì–´ë–¤ ë™ì‹œì„± ë¬¸ì œì™€ ì–´ë–¤ ì¢…ë¥˜ì˜ í•˜ë“œì›¨ì–´ì™€ ì†Œí”„íŠ¸ì›¨ì–´ ê²°í•¨ì´ ì¡´ìž¬í•˜ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼ ë™ìž‘í•  ìˆ˜ ìžˆê²Œ ë„ì™€ì£¼ëŠ” ì¶”ìƒì¸µì´ë‹¤.

### ì™„í™”ëœ ê²©ë¦¬ìˆ˜ì¤€

- ë”í‹° ì½ê¸°
  - í•œ Clientê°€ ë‹¤ë¥¸ Clientê°€ ì¼ì§€ë§Œ ì•„ì§ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì½ëŠ”ë‹¤.
  - read committed ì´ìƒ ìˆ˜ì¤€ì—ì„œ ë°©ì§€
- ë”í‹° ì“°ê¸°
  - í•œ Clientì´ ë‹¤ë¥¸ Clientê°€ ì¼ì§€ë§Œ ì•„ì§ ì»¤ë°‹ë˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ë®ì–´ì“´ë‹¤.
  - ê±°ì˜ ëª¨ë“  íŠ¸ëžœìž­ì…˜ êµ¬í˜„ì€ ë”í‹° ì“°ê¸°ë¥¼ ë°©ì§€
- ì½ê¸° ìŠ¤í(ë¹„ë°˜ë³µ ì½ê¸°)
  - ClientëŠ” ë‹¤ë¥¸ ì‹œì ì— ë°ì´í„°ë² ì´ìŠ¤ì˜ ë‹¤ë¥¸ ë¶€ë¶„ì„ ë³¸ë‹¤.
  - ìŠ¤ëƒ…ìˆ ê²©ë¦¬(Repeatable Read)ë¥¼ ë§Žì´ ì‚¬ìš©í•œë‹¤.
    - MVCCë¡œ êµ¬í˜„
- ê°±ì‹  ì†ì‹¤
  - ë‘ Clientê°€ read-modify-write ì£¼ê¸°ë¥¼ ì‹¤í–‰í•˜ì—¬, ë°ì´í„°ê°€ ì†ì‹¤ëœë‹¤.
  - ìŠ¤ëƒ…ìˆ ê²©ë¦¬ ì¤‘ ì¼ë¶€ëŠ” ì´ë¥¼ ìžë™ìœ¼ë¡œ ë§‰ì•„ì£¼ì§€ë§Œ ê·¸ ì™¸ì—ëŠ” ìˆ˜ë™ ìž ê¸ˆ(`SELECT FOR UPDATE`) í•„ìš”
- ì“°ê¸° ìŠ¤í
  - ë¬´ì–¸ê°€ ì½ê³ , ì½ì€ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ì–´ë–¤ ê²°ì •ì„ í•˜ê³  ê·¸ ê²°ì •ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ì“´ë‹¤. ê·¸ëŸ¬ë‚˜ ì“°ê¸°ë¥¼ ì‹¤í–‰í•  ë•ŒëŠ” ê²°ì •ì˜ ì „ì œê°€ ì°¸ì´ ì•„ë‹ˆë‹¤.
  - ì§ë ¬ì„± ê²©ë¦¬ë§Œ ë°©ì§€ ê°€ëŠ¥
- íŒ¬í…€ ì½ê¸°
  - í•œ íŠ¸ëžœìž­ì…˜ì´ ê²€ìƒ‰ ì¡°ê±´ì— ë¶€í•©í•˜ëŠ” ê°ì²´ë¥¼ ì½ëŠ”ë‹¤. ë‹¤ë¥¸ íŠ¸ëžœìž­ì…˜ì´ ê·¸ ê²€ìƒ‰ ê²°ê³¼ì— ì˜í–¥ì„ ì£¼ëŠ” ì“°ê¸°ë¥¼ ì‹¤í–‰í•œë‹¤.
  - ìŠ¤ëƒ…ìˆ ê²©ë¦¬ëŠ” ê°„ë‹¨í•œ íŒ¬í…€ ì½ê¸°ëŠ” ë§‰ì•„ì£¼ì§€ë§Œ, ì“°ê¸° ìŠ¤íì˜ íŒ¬í…€ì€ ìƒ‰ì¸ ë²”ìœ„ ìž ê¸ˆì²˜ëŸ¼ íŠ¹ë³„í•œ ì²˜ë¦¬ê°€ í•„ìš”í•˜ë‹¤.

### ì§ë ¬ì„± ê²©ë¦¬

- ë§ ê·¸ëŒ€ë¡œ íŠ¸ëžœìž­ì…˜ì„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ê¸°
  - íŠ¸ëžœìž­ì…˜ì˜ ì‹¤í–‰ ì‹œê°„ì´ ì§§ê³  ë‹¨ì¼ CPU ì½”ì–´ì—ì„œ ì²˜ë¦¬í•  ìˆ˜ ìžˆì„ ì •ë„ë¡œ íŠ¸ëžœìž­ì…˜ ì²˜ë¦¬ëŸ‰ì´ ë‚®ë‹¤ë©´ ì•„ì£¼ ê°„ë‹¨í•˜ê³  íš¨ê³¼ì ì¸ ì„ íƒ
- 2ë‹¨ê³„ ìž ê¸ˆ
  - ìˆ˜ì‹­ë…„ ë™ì•ˆ ì§ë ¬ì„±ì„ êµ¬í˜„í•˜ëŠ” í‘œì¤€ì ì¸ ë°©ë²•ì´ì§€ë§Œ ì„±ëŠ¥ì´ ë‚®ë‹¤.
- ì§ë ¬ì„± ìŠ¤ëƒ…ìˆ ê²©ë¦¬(SSI)
  - ë‚™ê´€ì  ë™ì‹œì„± ì œì–´ë¥¼ ì‚¬ìš©í•´ì„œ íŠ¸ëžœìž­ì…˜ì´ ì°¨ë‹¨ë˜ì§€ ì•Šê³  ì§„í–‰í•  ìˆ˜ ìžˆê²Œ í•œë‹¤.
  - íŠ¸ëžœìž­ì…˜ì´ ì»¤ë°‹ì„ ì›í•  ë•Œ íŠ¸ëžœìž­ì…˜ì„ í™•ì¸í•´ì„œ ì‹¤í–‰ì´ ì§ë ¬ì ì´ì§€ ì•Šìœ¼ë©´ ì–´ë³´íŠ¸ì‹œí‚¨ë‹¤.
  